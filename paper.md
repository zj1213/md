# 隐蔽数据回传

## 一、匿名聊天室或论坛

**思路**：重点研究telegram等匿名聊天工具，探究通过此类匿名软件实现隐蔽数据回传的可行性。



### 1、Telegram

#### （1）简介

Telegram（非正式简称TG）是跨平台的即时通信软件，其客户端是自由及开放源代码软件，但服务器端是专有软件。用户可以相互交换加密与自毁消息（类似于“阅后即焚”），发送照片、影片等所有类型文件。 



##### （一）：聊天内容加密

    "Telegram uses a proprietary encryption protocol, MTproto."

众所周知，TG对所有聊天内容都可以使用MTproto端对端加密 安全可靠，不同聊天对象生成不同加密密钥。可以随意启用或关闭加密功能。为消息加密这一点保护了用户的个人隐私，光是这一点绝大多数app就已经望尘莫及了。TG创始人Durov曾经立下20万美元奖金由于奖励能破解加密方式的黑客，然而自发布以来只有一个人发现了一个小漏洞拿到了10万美元的奖金。

[![f9K9UI.png](https://z3.ax1x.com/2021/08/02/f9K9UI.png)](https://imgtu.com/i/f9K9UI)

​																								MTproto加密原理



另外，TG的消息支持双向撤回，无时间限制，且发出后可编辑内容，意思就是说，你可以随时撤回你自己以及好友发出的消息，而且是真正意义上在服务器端的删除消息，你和对方在任何终端用任何方法，甚至连TG官方都无法查看已删除的消息

[![f9uzbd.png](https://z3.ax1x.com/2021/08/02/f9uzbd.png)](https://imgtu.com/i/f9uzbd)



##### （二）：极其夸张的文件保存机制

与微信与qq不同，TG上的文件是不会过期的，并且文件上限达到了惊人的2GB，这意味着你可以查看其他用户几年前发的文件，甚至把TG当作个人网盘

比较神奇的例子：某频道把GTA5拆成几十个小部分放在频道里，只要把每个文件下载到同一个文件夹里就能运行GTA5 （当然了，不提倡盗版行为）

[![f9KC5t.png](https://z3.ax1x.com/2021/08/02/f9KC5t.png)](https://imgtu.com/i/f9KC5t)

##### （三）：功能极其丰富，并且所有功能完全免费

一个TG群聊的人数是没有上限的，比如python官方的讨论区，人数达到了8万6千人

[![f9uxDH.png](https://z3.ax1x.com/2021/08/02/f9uxDH.png)](https://imgtu.com/i/f9uxDH)



让如此之大的一个群组工作正常，让几万个用户同时发消息时不会卡顿，很大程度上依赖于TG优秀且高效的管理工具，比如自定义所有成员的权限，以及限制成员发送消息的内容和频率，还有界面保存所有管理员以及群主的操作，避免误操。

[![f9KpVA.png](https://z3.ax1x.com/2021/08/02/f9KpVA.png)](https://imgtu.com/i/f9KpVA)

除此之外的功能还有很多，比如群组机器人，这里就不一一赘述了



#### （2）实践

安装雷电模拟器，尝试在电脑上安装telegram，安装成功后，却无法注册，查询后发现可能是由于需要翻墙才能正常使用。故后面只从理论层面进行分析。

[![fpvalT.png](https://z3.ax1x.com/2021/08/02/fpvalT.png)

[![f9luad.png](https://z3.ax1x.com/2021/08/02/f9luad.png)](https://imgtu.com/i/f9luad)

#### （3）分析



据telegram官方解释：任何通过 Telegram 收发的数据（包括多媒体文件和文档文件），均不可能被你的 ISP、网管或其他第三方解密。使用的MTProto 算法已经时间验证，能在微弱的网络连接下，维持高速传输和可靠性、安全性。Telegram 特殊的加密对话使用点对点加密传输，不会在我们的服务器上留下任何痕迹。此外，加密对话提供阅后即焚功能，也不支持转发。记住一点，加密对话没有用到云存储 － 它们只能在对话双方的设备上被读取（本地加密）。

我对此持怀疑态度，我相信或许如他所说，他的加密方法是安全的，但是在数据传输过程中真的能做到对服务器完全透明吗？



Telegram的客户端是开源的，服务器端是专有的；因此仅仅客户端的开源并不能让我们信任服务器端。

**端到端加密**(E2EE)：端到端加密直接使用对话者的公钥进行加密，服务器方（如果存在服务器的话）只负责传递消息，并不能知道消息的具体内容。

[![fCblwR.png](https://z3.ax1x.com/2021/08/03/fCblwR.png)](https://imgtu.com/i/fCblwR)

目前只有Telegram没有被曝光与任何监控计划有关，但是Telegram一直在关闭、封锁恐怖组织的频道和账号。

再通过对新闻中的描述，我推断，telegram是具备解锁用户信息的能力的。

[![fCbyff.png](https://z3.ax1x.com/2021/08/03/fCbyff.png)](https://imgtu.com/i/fCbyff)

并且如果传输过程中存在交易行为也是能够被锁定的。



- 

### 2、tox

#### （1）简介

与传统的IM软件相比，Tox有以下特性：

- **P2P**：Tox是一个分布式，P2P的系统，不依赖于任何中央服务器，所有通信使用端到端加密，这也就根绝了受监控、绑定个人信息、保存聊天记录等危险。
- **开源**：Tox是一个开源项目，其源代码全部公开，避免了植入后门的危险。

Tox本身只是一个通讯协议，在此基础上开发出了Tox核心(Core)——一个包含创建的协议和应用程序接口的程序库，而在这之上有各种版本的客户端。这些客户端大多也是开源的。在Windows系统上表现最好的客户端是qTox。

![img](https://pic2.zhimg.com/80/v2-0d1f835c055d0df7437017ac3fa74115_720w.jpg)qTox

为了了解Tox的工作原理，接下来对Tox核心的主要模块做一个简单的介绍。



##### 0x01**加密核心(Crypto Core)模块**

Tox的加密依赖于NaCl加密库，加密核心模块对此进行了一些封装，从而为一些加密相关的函数提供一些很好的接口。



##### 0x02**网络(Network)模块**

网络模块封装了UDP套接字，可以与操作系统底层的套接字函数进行交互，从而为UDP套接字和其他网络相关功能提供了简单的接口。



##### 0x03**分布式散列表(DHT)模块**

分布式散列表是Tox实现分布式的核心模块，他用来将一个关键值（key）的集合分散到所有在分散式系统中的节点，并且可以有效地将讯息转送到唯一一个拥有查询者提供的关键值的节点（Peers）。这里的节点类似散列表中的储存位置。DHT被广泛应用于各种分布式系统中，比如常用的下载协议BitTorrent。

DHT模块是Tox网络中所有节点的自组织群体。 该模块负责查找对等端的IP和端口，并在需要时通过UDP建立路由。 DHT只在UDP上运行，所以只在UDP启用时才会使用。
Tox DHT中的每个节点都有一个临时公钥。 该DHT公钥充当其地址。 该地址是临时的，每当关闭或重新启动Tox时都会更新。 

![img](https://pic4.zhimg.com/80/v2-9b961762b95ff1b927e452f71083b2e7_720w.jpg)分布式散列表(DHT)



##### 0x04**洋葱(Onion)模块**

使用洋葱模块可以找到好友的DHT公钥。 一旦知道了朋友的DHT公钥，就使用DHT找到它们并通过UDP直接连接到它们。 

Tox中的洋葱模块的目标是防止非好友节点从节点的已知长期公钥中找出临时DHT公钥，并防止对方在知道临时DHT公钥的情况下找到长期公钥。

它确保只有节点的好友才能找到并连接到它，并间接确保非好友即使知道Tox地址也无法获取到IP地址。

防止网络中的节点将临时DHT公钥与长期公钥关联的唯一方法是不广播长期密钥，对于非好友节点只使用临时DHT公钥。

洋葱模块允许节点分享他们的好友的他们的DHT公钥以让别人可以找到并连接到他们，但这些陌生人是无法获得长期公钥的。

那么洋葱模块是如何工作的？

洋葱模块的工作方式是让节点通过洋葱路由向好友宣布他们真正的公钥。它就像一个使用洋葱路由的DHT。事实上，它使用DHT，以便让其他节点能够通过洋葱路径找到最接近其公钥的ID。

为了在使用洋葱模块时匿名地向Tox网络公布其真实的公钥，它首先挑选3个它知道的随机节点（它们可以来自任何地方：DHT，连接的TCP中继或找到与洋葱同级的节点）。应该选择那些不太可能由同一个人操作的节点，可以通过查看IP地址或其他方式并查看它们是否处于相同的子网。

选择3个节点的原因是Tor和其他基于洋葱路由的匿名网络也是这样的。

![img](https://pic3.zhimg.com/80/v2-ddb406b2acb3578ba291fe968a87d91a_720w.jpg)洋葱模块的匿名方式仿照了洋葱路由																									(Tor)



##### 0x05**网络加密(Net Crypto)模块**

Tox传输协议是Tox用来安全地将数据安全地发送给朋友并提供加密，有序传送以及完美的前向保密的协议。它是一个UDP协议。

Tox传输协议具有在找到两者之间的路由或通信链路后安全地连接两个节点（tox好友）的功能。此外，如果节点知道他们想要连接的节点的真实公共密钥和DHT公共密钥，则只能使用Tox传输协议连接到另一方。但是，DHT需要这些信息才能找到并打开到节点的路由，这意味着我们假设该信息由toxcore知道，并且在创建net_crypto连接时已传递给net_crypto。

由于此协议必须通过UDP工作，因此它必须考虑到可能的数据包丢失，或者数据吧以错误顺序到达，并且必须实施某种拥塞控制。这是在数据包被加密的前提之上实现的。

在发送实际的握手数据包之前，对等方必须获得一个cookie。此cookie用于确认对方确实可以响应以防止某些类型的DoS攻击。

接收cookie请求数据包的节点不得为连接分配任何资源。他们只会用包含cookie的cookie响应数据包做出响应，然后请求的节点必须在握手过程中使用该响应数据包来启动实际的连接。

必须使用cookie请求数据包发送的完全相同的链接发回cookie响应。其原因是，如果使用另一个链接发回它，另一个链接可能不起作用，并且节点不会期望来自另一个链接的响应。例如，如果使用ip端口X从UDP发送请求，则它必须由UDP发回到IP端口X。

当接收到cookie请求时，对方不得在请求数据包中使用任何信息，而且不能存储它，他只能创建一个cookie和cookie响应，然后发送创建的cookie响应数据包并忘记它们。这是为了防止可能的攻击。例如，如果对等方为每个接收到的cookie请求数据包分配长期内存，那么简单的数据包泛滥就足以通过使程序内存不足而实现有效的拒绝服务攻击。

![img](https://pic3.zhimg.com/80/v2-3eb39002a2767ab302ca91f62cec0146_720w.jpg)握手过程

##### 0x06**好友请求(Firend Request)模块**

当Tox用户向Tox添加某人时，toxcore会尝试向该人发送朋友请求。好友请求包含发件人的长期公钥，nospam混淆码和消息。

传送长期公钥是好友请求的主要目标，因为节点找到对方并建立连接的前提。长期公钥是接收者接受好友请求时添加到他的好友列表中的内容。

nospam是一个用于防止骚扰的混淆码。它确保只有看过好友的Tox ID的人才能向他们发送好友请求。 nospam是Tox ID的组成部分之一。

nospam是由节点设置的一个数字或一个数字列表，只有收到的包含由相同设置的nospam的朋友请求才会发送到客户端，让用户接受或拒绝。 nospam防止网络中的随机节点将好友请求发送给非朋友。 4个字节足够大以防止来自网络中随机节点的垃圾信息。  nospam还可以允许Tox用户发布不同的Tox ID，甚至在有人发现Tox ID并决定向其发送数百个垃圾好友请求时更改Tox  ID。更改nospam可以阻止垃圾好友入侵，而不会对用户朋友列表产生任何负面影响。例如，如果用户不得不改变他们的公共密钥以防止他们接收到朋友请求，这意味着他们将必须放弃他们所有的当前好友，因为好友与公共密钥相关联。一旦好友互相添加，nospam就不会被使用，这意味着改变它不会有任何负面影响。

![img](https://pic3.zhimg.com/80/v2-fed1b8f1ab1449154608c50dc79c38e2_720w.jpg)NoSpam混淆码



##### 0x07**好友连接(Friend Connection)模块**

好友连接模块是位于DHT，洋葱和网络加密模块之上的模块，负责将3个模块连接在一起。

好友连接模块负责建立与好友的连接，并为上层联系人模块提供一个简单的界面来接收和发送消息，添加和删除朋友并知道朋友是连接（在线）还是未连接（离线）。

好友连接模块中的好友由其真实公钥代表。当好友连接模块添加好友时，会为该好友创建一个洋葱搜索条目。这意味着洋葱模块将开始寻找这个朋友，并且向该朋友发送DHT公钥。

一旦洋葱模块返回对方的DHT公钥，DHT公钥将被保存，并添加到DHT好友列表中，并创建一个新的网络加密模块连接。然后好友连接模块会将好友的IP /端口传递给网络加密模块，如果它断开连接，也将其保存为用于重新连接到好友。

如果网络加密模块发现该好友具有不同的DHT公钥（如果该朋友重新启动其客户端就可能发生），则网络加密模块会将新的DHT公钥传递给洋葱模块，并将删除旧的DHT公钥并将其替换为新的。当前的网络加密连接也将被终止，并且将会创建一个具有正确DHT公钥的新连接。

当朋友的网络加密连接上线时，好友连接模块会告诉洋葱模块该好友在线，以便它可以停止花费资源寻找好友。当朋友连接离线时，好友连接模块会通知洋葱模块，以便它可以再次开始寻找朋友。



##### 0x08**联系人(Messenger)模块**

联系人是最顶层的模块，联系人模块使用好友连接模块提供的连接来处理发送和接收消息。该模块为好友提供了一种连接方式，并使其可用作即时通讯工具。例如，联系人模块允许用户设置昵称和状态消息，然后在联机时将消息发送给好友。它还允许用户向好友发送消息，并在较低级别的好友连接模块上建立即时通信系统。



##### **群聊模块**

Tox中通过使用好友连接模块添加一些节点（最多4个）作为临时聊天，在退出群聊时删除群聊。

群聊中的每个节点都由其真实的长期公钥来标识，但是节点通过群聊将对方的DHT公钥发送给对方，以便通过使对等方无需找到对方的DHT公钥来加速连接。如果他们将自己添加为好友，则会使用洋葱模块。

使用好友连接模块的好处在于，群聊不需要处理底层网络连接上。然而，不利的一面是，每个人都知道彼此真正的长期公钥和DHT公钥，这意味着这些群组聊天只能在好友之间使用。

为了彼此连接，两个节点必须将另一个添加到他们的好友连接列表中。如果群组聊天的参与者数量等于或小于5，则这不是问题，因为5个节点中的每个人都将其他4个人添加到他们的朋友连接列表中。当有更多的节点时，必须有一种方法来确保节点能够连接到其他群聊节点。

要使用群聊，必须首先创建一个群聊，然后邀请好友加入群聊。

要创建一个群聊，节点会生成一个随机的32字节的ID，用来唯一标识这个群聊。 32字节就足够了，每个创建的组聊天都会有一个不同的ID。这个32字节ID的目标是让节点有一种识别每个群聊的方式，以免他们重复加入群聊。

#### （2）实践

下载qtox,注册两个新账户，发现有问题，无法进行通信。猜测可能是由于不能使用同一个ip地址创建两个账户，所以再ubuntu中也安装qtox。

[![fP3Cj0.png](https://z3.ax1x.com/2021/08/03/fP3Cj0.png)](https://imgtu.com/i/fP3Cj0)
[![fP39cq.png](https://z3.ax1x.com/2021/08/03/fP39cq.png)](https://imgtu.com/i/fP39cq)

成功实现通信，既可发送消息，也可语音、视频通话。现进一步验证其匿名性与通信的安全性。

[![fPUsOA.png](https://z3.ax1x.com/2021/08/03/fPUsOA.png)](https://imgtu.com/i/fPUsOA)



通过wireshark抓包分析






[![fi9EcR.png](https://z3.ax1x.com/2021/08/03/fi9EcR.png)](https://imgtu.com/i/fi9EcR)

设置了代理后抓包还是能看到本机ip（192.168.1.109、192.169.1.106）

[![fi9A39.png](https://z3.ax1x.com/2021/08/03/fi9A39.png)](https://imgtu.com/i/fi9A39)

**什么是匿名IP代理？**

匿名IP代理是代理的类型是不会发送您的身份信息到目标服务器。它与透明代理相反，透明代理在连接请求标头中发送您的信息。网站上设置的匿名IP代理有时也称为匿名器或匿名器网站。

**匿名IP代理安全吗？**

由受信任的代理网络提供的匿名IP代理是完全安全的。像我们前面提到的匿名网站一样，免费的匿名IP代理可以被政府或黑客设置为陷阱，以识别和窃取使用它们的任何人的数据。这就是为什么您只应使用来自受信任供应商的匿名IP代理的原因。匿名IP代理的唯一缺点是，它可能会使您与Internet的连接速度变慢，但是所有代理都会发生这种情况。

于是设置匿名ip

[![fiEGi6.png](https://z3.ax1x.com/2021/08/03/fiEGi6.png)](https://imgtu.com/i/fiEGi6)



经过无数次尝试，无论是设置透明代理还是所谓的高匿代理，发现用wireshark抓包还是能看到两台主机的ip。

我猜想可能是由于我的wireshark是监听的win7机的网口，由于是端到端传输，Tox不能提供匿名性——你的好友必须要知道你的IP地址，才能给你发送信息。流经的该端口的流量尚未经过处理，所以并不是匿名的，但是相对第三方攻击者来说应该是匿名的。

（3）分析

Tox不能提供匿名性——你的好友必须要知道你的IP地址，才能给你发送信息。使用代理或者Tor可以很好的解决这一点。

### 3、总结

在讨论即使通讯的安全性时，技术上主要从以下两方面来评价：

**加密性**：IM软件的加密性可以分为三个等级

1. **无加密**：早期的IM软件(如MSN)没有采用任何加密，聊天内容以明文的形式发送，这无异于在网络上裸奔。
2. **普通加密**：现在的IM软件大多实现了客户端与服务器间的加密通信，尽管采用的加密算法各不相同，一般是将使用服务器公钥进行加密后的信息传送到服务器，服务器用自己的密钥解密后再使用对话者的公钥加密并发送到对方客户端。这意味着服务器方是知道消息的具体内容的。但是这已经可以有效防止第三方窃取通信信息。有些IM软件提供商声称不会保留聊天数据，但是显然，他们是具有这个能力的。
3. **端到端加密**(E2EE)：端到端加密直接使用对话者的公钥进行加密，服务器方（如果存在服务器的话）只负责传递消息，并不能知道消息的具体内容。

**匿名性**：保持良好的匿名性，至少要在两个方面保持匿名：

1. **IP地址**：由于要与服务器或其他终端通信，必须提供IP地址。在普通加密中，这个IP地址会提供给服务器；在端到端加密中，IP地址会提供给通讯的对方。使用代理、Tor等工具就可以有效保护自己的IP。
2. **身份信息**：很多IM软件都需要强制绑定如手机号等身份信息，某些IM软件甚至会主动搜集用户信息。





Telegram:需要绑定手机号,Telegram只在本地保存聊天记录，但是频道和群聊的聊天记录是在服务器上保存的。

- **加密性**：较好
- **匿名性**：差
- **总体安全性**：较好



Tox:分布式、完全开源（不存在后门）

- **加密性**：较好
- **匿名性**：差（但可通过代理或Tor来实现较好的匿名性）
- **总体安全性**：较好

​	总的来说，匿名聊天软件并没有其宣传的那样安全。	使用Telegram等工具虽然看似匿名，但实际上并非绝对可靠，还是能够做到溯源IP的，特别是对于telegram来说，服务平台的可靠性还值得商榷。对于Tox，其主要问题是



------

## 二、暗网（darknet）、深网（deep web）

**思路：**重点研究Tor（The Onion Router）利用暗网的匿名性实现隐蔽数据传输（具体详见上面）

### 1、参考资料：

[凶险、罪恶还是自由？暗网到底是什么？]: https://www.huxiu.com/article/224422.html
[看破冰行动，了解暗网是张什么网？进入并不容易]: http://news.youth.cn/sh/201906/t20190626_11992096.htm
[攻击匿名网络（Tor）,溯源攻击者IP的]: http://bobao.360.cn/learning/detail/189.html



### 2、简介：

暗网又被称为隐藏网（Hidden Web），普通用户无法通过常规互联网手段搜索和访问它，它是深网（Deep Web）的重要组成部分。与之相对的是公众所熟悉的、通过搜索引擎和网址便能访问的表网（Surface Web）。

暗网通常存储于网络数据库中，但无法通过超链接访问，而是必须通过动态网页技术来访问。暗网的内容十分丰富，九成以上是动态内容，其余的包括未被链接内容、私有网站、受限存取内容、脚本化内容以及非HTML／文本内容等。

如何才能获取这些内容呢？主要有两种途径。“一是构建针对性的暗网爬虫和搜索引擎，二是使用暗网所有者提供的信息对接手段。从技术实现角度来说，暗网通常采用特定的编码关键词技术，利用‘洋葱路由（Tor）’‘隐形网计划（I2P）’等工具构建‘隐藏的服务器’。”

如果把被搜索引擎索引的页面看作表层网络，那么不能被检索的就是水面之下的深层网络，Deep web（深网）这个概念就来自这个意义。在移动互联网之后，整个形势发生了变化，越来越多的内容被封闭在App之内，搜索引擎无法检索，这些App形成了一块块互相不连接的领地，传统的互联网Web的“页面—链接”体系完全崩溃了。

Darknet这个概念主要强调网络层，Dark web指的是网络之上的应用。如果Dark net对应运营商，Dark  web可以对应成互联网服务商。运行在Darknet上的服务，哪怕是一个普通页面，也可以算作Dark web。除此之外，Deep  web里面很大一部分服务，也算Dark web，这三者的关系错综复杂又互相重叠。



**所以，到底为什么会存在暗网？**

**为了自由。**



### 3、暗网特点：

**支持匿名交谈，通信高度保密**

　　王文俊说，Tor是由美国海军研究实验室开发出来的匿名系统，用于避免在网上的活动被追踪到。普通用户下载安装相应软件后，便可访问暗网。

　　I2P则是利用“洋葱路由”的变体技术——大蒜路由，对网络中端到端的信息通道采用单向加密的匿名通信系统,通信隧道只掌握每一跳节点相邻节点的信息，但无法获知通信双方的通信关系，因而保证通信的匿名性。

​		暗网作为网络用户身份的匿名化通信系统，不仅从网络协议的改进、IP地址的动态化等方面进行技术伪装，还会对用户内容信息进行加密。量子保密通信是指以具备信息理论安全性证明的QKD技术作为密钥分发功能组件，结合适当的密钥管理、安全的密码算法和协议而形成的加密通信安全解决方案。而暗网则与其不同，它对用户身份、信息的保密更多基于网络协议和IP地址的代理转换，从而隐匿用户身份，让检测机构无法轻易获取到用户登录地址。

**加密货币助推暗网走向成熟**

​		而随着Tor的发布，暗网实现了彻底的匿名操作。2010年，Tor开始与加密货币结合，诞生了第一个黑市。“加密货币一直是暗网走向成熟的最大助推因素。”

### 4、尝试：

#### 1、Tor

##### 主要功能介绍

洋葱路由器是一个工具集，各类组织和个人可以用它来增强自己在互联网上的安全性。 洋葱路由器 能够匿名化你的 Web 浏览与发布、即时通讯、IRC、SSH 和其他使用 TCP 协议的应用。  洋葱路由器同时提供了一个平台，软件开发人员能够在上面构建具有内建匿名性、安全性与隐私保护特性的新的应用程序。

洋葱路由器Tor（The Onion Routel network)作为一种众所周知、广为接受的Internet匿名方案，已经有很长的历史，它发源于美国海军研究实验项目。

Tor是一个世界范围的计算机网络，在请求开始点以加密方式转发请求，直到到达网络中最后一台称为出口节点（exit  node）的计算机。出口节点会对请求进行解密并传输到目标服务器。出口节点是专门用于流量离开Tor网络的最后一跳，也是用于返回流量的第一跳。使用Tor时，与您通信的系统将所有传入的流量视为来自出口节点。他们不知道您的位置，也不知道您的真实IP地址。此外，Tor网络中其他系统也不能确定您的位置，因为实质上只是转发流量，并不知道流量的实际来。请求的响应将返回系统，但对于Tor网络而言，流量源仅充当了路径中的一跳。本质上，您是匿名的。

洋葱路由器的目标是抵御流量分析，流量分析是一种对网络的监视行为，这种行为会威胁个人的匿名与隐私，商业活动与业务关系的保密和国家的安全。通信在一个由称作洋葱路由器的服务器所构建的[分布式网络](https://baike.baidu.com/item/分布式网络)上传输， 保护你以避免网站收集你的兴趣爱好，本地的、甚至是洋葱路由器上的窃听者阅读你的数据、了解你所访问的站点。 [1] 



###### 匿名浏览网页

Tor作为一款免费的匿名软件，大部分的Tor用户将之作为一个匿名浏览网页的工具，不过实际上它潜力十足：Tor软件可以再操作系统后台运行，创建一个代理链接将用户连接到Tor网络。随着越来越多的软件甚至操作系统都开始允许用户选择通过Tor链接发送所有流量，这使得你几乎可以用任何类型的在线服务来掩盖自己的身份。

随着网络犯罪日益增长，而这个时候Tor的出现对不少人来说的确是个好消息。作为一款简单的浏览器，他通过不同的网络节点为人们提供完整的匿名网络服务。如果需要访问目标网站，中间需要通过复杂的网络节点，而在这过程你是一直处于匿名状态。



###### 研究恶意软件

研究恶意软件时，您可能要比浏览web更加需要隐匿。Tor可与URL获取命令行工具（如wget）一起使用，或者在连接到SSH、FTP或IRC服务器时使用。可用一些工具将Tor封装到应用程序，以确保其连接看上去来自Tor网络，而不是直接来自于您的网络。



下载tor浏览器，尝试链接暗网。

[![fSd25D.png](https://z3.ax1x.com/2021/08/02/fSd25D.png)](https://imgtu.com/i/fSd25D)

如今（今年7月）已由洋葱版本2改为版本3，原有的许多网址都暂时连接不上了.测试失败。

### 5、风险：

可通过监控Tor等浏览器的下载信息来顺藤摸瓜，跟踪暗网用户并监控其在暗网中的行为；

也可主动创建暗网陷阱，对犯罪分子等用户开放，坐等违法犯罪分子入瓮；

还可让政府监管人员扮演成暗网用户进行卧底，深入虎穴，成功取证。



证明使用暗网并非完全匿名，做不到绝对安全，只不过相对来说加大了溯源的难度，如果在使用时多加注意还是可以作为一种相对隐蔽的数据传输手段。下面是一种IP溯源方法，在国外研究员的博客，提供了几种攻击思路，每一种的攻击成本都特别高，不是一般人可以做到的，很多攻击手法都是国家层次才可以实施的攻击手法。

#### （1）IP溯源方法

##### **0x01 基于NetFlow的流量分析攻击**

研究员做了相关测试，指出以前利用对tor网络出口和入口的network数据分析来追踪tor网络需要大量的基础设施和设备，基本上只有政府和专门的机构才能够实现；现在有研究者测试通过一台单独的系统能够监控39%的tor网络。现在的流量分析攻击不需要像以前那样配置大量的基础设备，但需要一个或多个高宽带、高性能的Tor中继服务器，Chakravarty研究团队利用在哥伦比亚大学的一台运行着linux系统的Tor中继服务器做了实验测试，下面是测试图示：

[![fpQKRf.jpg](https://z3.ax1x.com/2021/08/02/fpQKRf.jpg)](https://imgtu.com/i/fpQKRf)

[![fpMnvF.jpg](https://z3.ax1x.com/2021/08/02/fpMnvF.jpg)](https://imgtu.com/i/fpMnvF)

##### **0x02.攻击使用TOR网络进行比特币交易的用户**

大多数比特币交易用户认为使用TOR进行交易不会被追踪，但是卢森堡大学的研究人员Alex Biryukov, Dmitry Khovratovich,和Ivan  Pustogarov发布了一篇论文，证明利用比特币架构的缺陷，能够获取到交易用户的真实IP信息。攻击者只需伪造一段恶意的报文，通过P2P网络发送超过100个的假消息，比特币服务器就会阻止这个IP连接24小时。这个机制本意是比特币服务器防止攻击者通过TOR网络来进行DOS攻击。但是却被攻击者滥用在这种攻击手法中了，攻击者会强制比特币服务器拒绝从TOR或其他匿名服务中的连接，这就导致使用匿名网络的比特币终端用户当连接到比特币服务器时，会暴露自己的原始IP。比特币架构中类似的问题还有很多。下面是原理图：


[![fpMmgU.jpg](https://z3.ax1x.com/2021/08/02/fpMmgU.jpg)](https://imgtu.com/i/fpMmgU)

##### **0x03.通过攻击目录认证服务器，瘫痪整个TOR网络**

前面讨论的3种攻击方法，都揭示出可以获取TOR用户源IP信息的可能性，最后一种攻击方法，我们讨论下能够危害到整体TOR框架网络的可能性，攻击TOR目录认证服务器，瘫痪整个TOR网络。

众所周知，TOR整体网络依赖9个目录认证服务器，这些服务器位于欧洲和美国，攻击者可以直接攻击这9台服务器，或漏洞攻击，或拒绝服务攻击，或物理攻击来实现破坏，TOR项目负责人Roger  Dingledine有在博客中爆料，曾发现攻击这些服务器的行为，但是他们已经做了安全加固，针对这些服务器器的攻击还是比较难的，但是并非不可能发生。

最后我想说：“每个人都有隐私权。这项权利是民主社会的基础。“

##### **0x04.参考文档：**

http://resources.infosecinstitute.com/hacking-tor-online-anonymity/

http://securityaffairs.co/wordpress/30202/hacking/tor-traffic-analysis-attack.html

http://securityaffairs.co/wordpress/30160/cyber-crime/law-enforcement-operation-onymous.html

https://blog.torproject.org/blog/possible-upcoming-attempts-disable-tor-network

http://securityaffairs.co/wordpress/30202/hacking/tor-traffic-analysis-attack.html

http://securityaffairs.co/wordpress/31380/hacking/directory-authorities-block-tor-network.html

http://securityaffairs.co/wordpress/29952/cyber-crime/operation-onymous-vs-dark-markets.html

https://mice.cs.columbia.edu/getTechreport.php?techreportID=1545&format=pdf&

http://securityaffairs.co/wordpress/30610/hacking/bitcoin-anonymity-hacked.html

http://orbilu.uni.lu/handle/10993/18679

http://www.ibtimes.co.uk/bitcoin-anonymity-theres-way-hackers-find-out-your-ip-address-1476605

#### （2）网络调查技术(NIT)

网络调查技术是FBI用来描述使用恶意软件、漏洞利用和各种黑客战术追踪罪犯的概括性术语。

NIT是一个基于flash的路过式下载应用程序，它由H.D.Moore开发，并作为Metasploit的一部分发布。NIT，或者更正式地说是Metasploit  Decloaking引擎旨在提供Web用户的真实IP地址，无论他们是否进行了代理设置，其目的是访问计算机，获取系统相关信息或计算机中包含的数据。

例如美国FBI的Operation Torpedo中使用的工具是现已停止开发的Metasploit Decloaking Engine，Decloaking  Engine使用了五种不同的方法破解匿名系统，其中一种方法是与终端用户建立直接连接的 Adobe  Flash应用，绕过Tor的保护暴露了用户的真实IP地址。 Tor项目早知道这一弱点，它一直建议用户不要安装 Flash。

至少自2002年以来，FBI在计算机入侵、儿童色情、炸弹威胁、敲诈、恐怖主义等案件中使用NIT。NIT获取的信息包括计算机名称和地址、完整的文件、网络历史记录、网络摄像头活动等。由于FBI已开始使用NIT追踪使用Tor的网络黑客，NIT工具已经引起极大关注。



**典型事例**

案例一

FBI获得了法庭授权，将一小段代码（NIT）添加到受害者2号的视频文件中，将其作为诱骗受害者的“钓鱼”视频。经过授权，FBI随后将包含NIT的视频文件上传到只有Hernandez和受害者2号才知道的Dropbox.com帐户中。当Hernandez在计算机上查看包含NIT的视频时，NIT就会将Hernandez所使用的计算机IP地址发送回FBI控制的服务器中。



案例二

2011年，NIT曾被FBI运行“Operation Torpedo”时使用，“这是FBI第一次大规模地部署跟踪代码来针对每个访问网站的用户，而不是针对特定用户。”

政府机构寻求扩大NIT的使用范围，但目前只有法官能签发NIT逮捕令监控法官所在司法管辖权内的计算机。



案例三

法庭记录显示，FBI向受害者提供一封电子邮件的附件，该附件将作为目标用户需要填写的表格，需要在该企业（受害者）付款前填写。这一文档要求用户（网络犯罪分子）退出“保护模式”，该模式在Microsoft  Word中用于阻止文档连接到网络。在申请搜查令的过程中，FBI表示无需向政府申请就可以向目标发送嵌入式图像，但出于谨慎，再加上目标用户需要主动关闭保护模式的事实，FBI还是申请了这一搜查令。

根据申请内容，这两个“恶意”Word文档都被设计为仅获取目标IP地址和User Agent字符串。User Agent字符串可以显示目标正在使用的操作系统。尽管申请由两位不同的FBI特工签署，但它们都来自于纽约罗彻斯特Buffalo分部的网络小组。

我们并不知道这些网络调查技术在识别嫌疑人方面已经取得了怎样的成果。但在Gorbel案件中，司法部多次要求延期公开，从而保证搜查令中具体细节的保密性。
 “使用网络调查技术是合法且有效的”，FBI发言人在一封电子邮件中告诉Motherboard。“他们只在必要时，才会对一些较高级别的罪犯使用这项技术。这项技术耗费时间和资源，对大多数调查来说都不是一个可行的选择。”



**NIT使用引争议** 

NIT工具的使用引发了《第四修正案》的担忧与司法问题。尽管法院有法院令，但FBI迄今为止拒绝在一起涉及Tor匿名网络的儿童性虐案件中提供完整代码。

2016年5月12日，Mozilla提交法庭陈述，因为FBI利用Mozilla  Firefox网络浏览器将数百万用户置于风险之中。Mozilla要求在将代码提供给被告之前提供给他们，从而引起《第五修正案》的问题。此外，美国华盛顿塔科马市地方法官罗伯特·布莱恩裁定，虽然美国诉米肖案（United States v.  Michaud）被告有权查看代码，而政府也有权保密。然而，2016年5月25日，这名法官裁定，出于记录在案的口头陈述原因、以及根据NIT证据签发的搜查令，因此搜查令获取的结果应当排除在外，不得在审讯中作为证据。

2017年3月，美国公民自由联盟、电子前沿基金会和全国刑事辩护律师协会发布了长达188页指南，对第《第四修正案》进行分析。4月，明尼苏达州法官裁定，由于FBI特工了解裁定超越了Rule41的司法要求，搜查令自签发之时就无效。所有搜查令收集的证据属非法获取。



普通民众只在零星的报道中，得知与其相关的信息泄露或法庭文件。比如上月，外媒 Motherboard 拿到了一份文件，其中详细说明了 ——  FBI  是如何冒充联邦快递（FedEx）来部署恶意软件，以抓捕诈骗者；以及他们如何假冒新闻机构，欺骗青少年下载恶意软件，以确定其关于炸弹威胁的笑话是否属实。

此外，FBI 也在使用所谓的“水洞”（waterhole）攻击 —— 它们捕获[服务器](https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=p0hfitud)，并使用网络调查技术（NIT），在连接到这些服务器的任何设备上部署恶意软件。如果他们是在一个儿童色情上部署 NIT，相信普通民众是不会反对的；但若超出了适当的界限，或者实施中未受制约，那就令人唏嘘了。

在此前，FBI曾将网络调查技术运用在大规模的范围中，甚至有时会不加选择。在无线电通信局针对暗网托管服务提供商Freedom  Hosting进行调查时，发现网络调查技术还影响了一个不涉嫌犯罪的用户的一些电子邮件隐私。在新申请的搜查令中，FBI强调，只会针对特定目标运用网络调查技术。

另一份文件补充道：“FBI仅会对目标用户发送电子邮件，该用户会在登录邮箱和收取电子邮件后，才能打开电子邮件及其附件。针对电子邮件目标，会进行仔细检查，并直接发出邮件，从而避免任何侵犯公民隐私的行为。”

网络安全和监视专家Pfefferkorn表示：“政府已经从自由托管的案例中获得了经验，如果直接在政府接管的网站上部署NIT，并没有足够的针对性，最终感染了无辜公民的浏览器。”

#### （3）其他

其实，对于大多数暗网的参与者来说，各种疏忽都会导致你的身份泄露，例如：

如果你通过同一设备访问明文网站，那么你的真实IP就会暴露；

如果你的浏览器存在漏洞，也会被精确定位；

另外，知情人士分析，目前的暗网节点每月需要花费数千美元来维护，依靠强大的资金支持，FBI完全有可能**掌握大量Tor节点**，从而用**数学方法**验算出盘踞其上的每一个服务器和访问者的精准IP。

### 6、假想应用场景：

由于需要额外的软件安装与配置才能链接暗网，不太适用与远程用木马控制的电脑，也不太使用于内网或者物理隔绝互联网的电脑，故假想用途如下：

1、谍报人员使用自己电脑隐蔽数据回传所获取涉密数据。

2、潜入敌人内部，利用其公网电脑进行隐蔽数据回传（但此方法较易留下痕迹，毕竟要下载安装相关软件）

------

## 三、区块链

### 1、技术挑战

1、数据多副本：交易数据除了被接收方接收外还会被其他其他节点所保存

2、交易可溯源：区块链包含完整交易记录，易被攻击方溯源————》加强匿名机制

3、交易筛选难：由于接收方会收到大量的交易信息，从中筛选出有效的信息是困难的。需要特殊的识别机制

4、群组有泄密：需要研究抵御内部泄密者的机制。群组秘密包括：用于识别特殊交易的密钥、群组中的密钥更新机制、参加密钥更新的接收方的隐蔽数据

###  2、解决策略

#### （1）区块链数据隐蔽传输模型

1. 存储隐信道

   a、密文填充特殊字段

   b、分片编码

   c、转为交易或手续费金额

2. 时间隐信道

   a、协商交易数据包发送时间间隔

[<img src="https://z3.ax1x.com/2021/07/29/WqJzNT.png" alt="WqJzNT.png" style="zoom:33%;" />](https://imgtu.com/i/WqJzNT)
[<img src="https://z3.ax1x.com/2021/07/29/WqYC34.png" alt="WqYC34.png" style="zoom:33%;" />](https://imgtu.com/i/WqYC34)
[<img src="https://z3.ax1x.com/2021/07/29/WqY9CF.png" alt="WqY9CF.png" style="zoom:33%;" />](https://imgtu.com/i/WqY9CF)

#### （2）隐蔽传输参与者身份匿名机制

[<img src="https://z3.ax1x.com/2021/07/29/WqJOun.png" alt="WqJOun.png" style="zoom:33%;" />](https://imgtu.com/i/WqJOun)

1. 隐藏特殊交易账号关联关系的地址混淆机制

   [<img src="https://z3.ax1x.com/2021/07/29/WqYS4U.png" alt="WqYS4U.png" style="zoom:33%;" />](https://imgtu.com/i/WqYS4U)

2. 保证发送方匿名的签名混淆机制

   a、环签名算法

   [<img src="https://z3.ax1x.com/2021/07/29/WqYZE6.png" alt="WqYZE6.png" style="zoom:33%;" />](https://imgtu.com/i/WqYZE6)

#### （3）隐蔽高效的数据传输机制

[<img src="https://z3.ax1x.com/2021/07/29/WqYTVx.png" alt="WqYTVx.png" style="zoom:33%;" />](https://imgtu.com/i/WqYTVx)
[<img src="https://z3.ax1x.com/2021/07/29/WqYxsA.png" alt="WqYxsA.png" style="zoom:33%;" />](https://imgtu.com/i/WqYxsA)

1. 基于账号的可变标签机制--设计特殊的交易账号

   [<img src="https://z3.ax1x.com/2021/07/29/WqYIq1.png" alt="WqYIq1.png" style="zoom:33%;" />](https://imgtu.com/i/WqYIq1)

2. 基于特殊字段的可变标签机制--设计特殊的数据格式

   [<img src="https://z3.ax1x.com/2021/07/29/WqYORe.png" alt="WqYORe.png" style="zoom:33%;" />](https://imgtu.com/i/WqYORe)

#### （4）群组隐蔽传输安全机制

[![WqzCJH.md.png](https://z3.ax1x.com/2021/07/30/WqzCJH.md.png)](https://imgtu.com/i/WqzCJH)

1. 容忍内部泄密的秘钥更新机制

   [<img src="https://z3.ax1x.com/2021/07/30/WqzPWd.md.png" alt="WqzPWd.md.png"  />](https://imgtu.com/i/WqzPWd)

2. 基于区块链的隐蔽数据传输原型系统

[![Wqz9Fe.md.png](https://z3.ax1x.com/2021/07/30/Wqz9Fe.md.png)](https://imgtu.com/i/Wqz9Fe)

------

## 四、防火墙绕过技术（DDOS、UDP）

#### 疑惑

为何只是发比较大的文件防火墙就会将其当做DDOS攻击流量来拦截？那这样他们（敌方）正常的流量怎么传输？而且一般防火墙需要拦截的UDP流量都是具有相似载荷的，而我们传输数据时应该不会是相同载荷吧？为何防火墙会进行拦截？难道是限流型？那这样只需要控制流量大小应该就没问题了吧。



**单位时间内如果穿过防火墙的“同类”数据流超过门限值后，可以设定对该种类的数据流进行阻断，对于防止IP、ICMP、UDP等非连接的flood攻击具有很好的防御效果。**

UDP  Flood攻击报文具有一定的特点，这些攻击报文通常都拥有相同的特征字段，比如都包含某一个字符串，或整个报文内容一致。这些字段来自于DDoS工具自带的默认字符串，所以防火墙是通过收集这些字符串来检测UDP  Flood。这种防御算法在现网使用很多，主要因为黑客为了加大攻击频率，快速、长时间挤占攻击目标所在网络带宽，在使用攻击工具实现时直接在内存存放一段内容，然后高频发送到攻击目标，所以攻击报文具有很高的相似性。而正常业务的UDP报文一般每个报文负载内容都是不一样的，这样可以减少误判。
 从下面的抓包中可以看出，到达相同目的IP地址的两个UDP报文的载荷是完全一样的，如果防火墙收到大量的类似这样的UDP报文，那么就有可能是发生了UDP Flood攻击。



防火墙防御UDP  Flood攻击主要有两种方式：限流和指纹学习，两种方式各有利弊。限流方式属于暴力型，可以很快将UDP流量限制在一个合理的范围内，但是不分青红皂白，超过就丢，可能会丢弃一些正常报文；而指纹学习属于理智型，不会随意丢弃报文，但是发生攻击后需要有个指纹学习的过程。









------

## 五、基于Internet网络协议的信息隐藏技术

**利用包头的保留比特位、特殊情况不用的字段、具有随机性的字段**
https://www.ixueshu.com/document/f4413e640aa446b99016484753cca7f8318947a18e7f9386.html

### （1）网络层

1、将IP标识字段作为隐秘载体
2、IP协议头校验和

### （2）传输层——大多基于TCP包进行隐蔽数据传输

1、TCP序列号字段

2、应答号

### （3）应用层

优势：*1.*当前内网常用代理服务器，会改写流经的网络层和传输层数据流。而对应用层的改动很小。

​			*2.*前两者改动通常需要系统权限，因为这些协议通常有操作系统提供，而应用层协议不用

1、**HTTP**、SMTP、DNS、FTP

------

## 六、基于临时邮箱

​      什么是临时邮箱？     

**临时邮箱：**是指能接收邮件的临时邮箱，也称为一次性邮箱，24小时邮箱，10分钟邮箱，可丢弃邮箱，是完全匿名和安全的。

常常有网站要求我们提供有效的电子邮件地址，以便注册，查看或接收特定内容、服务使用等。但是您以后都不太可能回到这个网站/博客/论坛，使用您的真实邮箱注册的话以后就有可能经常收到垃圾邮件、广告邮件。 处理此问题的一个好方法是在您不确定网站是否完全可信且值得信赖时使用临时的一次性邮件地址。  临时邮件与任何其他电子邮件服务一样，但它是短暂的临时的，用完即自动销毁。使用我们的服务，您将不再担心收到垃圾邮件和其他垃圾邮件，还可以避免被跟踪。

[![WOkwuQ.md.png](https://z3.ax1x.com/2021/07/30/WOkwuQ.md.png)](https://imgtu.com/i/WOkwuQ)



<img src="https://exp-picture.cdn.bcebos.com/f9617afb960b31215abf4e10dee983aee9d76d71.jpg?x-bce-process=image%2Fresize%2Cm_lfit%2Cw_500%2Climit_1%2Fquality%2Cq_80" alt="怎么通过邮件查询对方IP地址"  />

推荐：https://protonmail.com/

ProtonMail的限制包括最多500MB的储存空间，以及每天发送最多150封邮件

[![WOkajg.md.png](https://z3.ax1x.com/2021/07/30/WOkajg.md.png)](https://imgtu.com/i/WOkajg)

​	**警告**

​	要找出匿名邮件的IP地址相当简单。为了防止IP地址被人发现，你需要使用VPN来发送匿名邮件，或者使用ProtonMail。

​	千万不要用匿名地址发送垃圾邮件或威胁别人。这是违法的行为，被抓住了会受到起诉。

​	用匿名地址进行违法活动还是有可能会被抓住。

### IP查询工具

#### 工具简介

通过该工具可以查询指定IP的物理地址或域名服务器的IP和物理地址，及所在国家或城市，甚至精确到某个网吧，机房或学校等；查出的结果仅供参考！

 数字地址：即IP地址的数字化形式，复制在浏览器中访问就和访问IP一样

[![WOk0Bj.md.png](https://z3.ax1x.com/2021/07/30/WOk0Bj.md.png)](https://imgtu.com/i/WOk0Bj)



[![WOyJIg.md.png](https://z3.ax1x.com/2021/07/30/WOyJIg.md.png)](https://imgtu.com/i/WOyJIg)



### 假想应用场景：

1、对于大多数临时邮箱，都只支持接收邮件，不支持发送邮件，所以可用于利用受控者电脑发送邮件到临时邮箱进行隐蔽数据回传，实现接收方的匿名。

2、这里推荐一款邮箱ProtonMail，其通加密等手段隐藏了ip地址，且极大增加了回查ip地址的难度，所以能相对安全的实现邮件收发。（ps：其还有个好的功能就是可用于账号注册，在现有工作环境中不能暴露个人信息，而此邮箱你可先通过一个临时邮箱注册，然后即可永久当做匿名邮箱使用，既不用担心临时邮箱那种失效的问题，又提供相对良好的匿名性。）

------

## LORA模块学习

https://blog.csdn.net/xiaohu1996/article/details/82797514
https://blog.csdn.net/xiaohu1996/article/details/103330626
https://blog.csdn.net/xiaohu1996/article/details/106072626



## 卫星网络安全协议

面向DVB-S2协议的信息隐藏技术研究https://www.ixueshu.com/document/79da8b70f0a1bdbab44bf6396367e2a1318947a18e7f9386.html



------





